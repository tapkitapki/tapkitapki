<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–æ—Ä—É–º - –†—ã–±–∞–ª–∫–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="container">
            <h1>–†—ã–±–∞–ª–∫–∞</h1>
            <nav>
                <ul>
                    <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="news.html">–ù–æ–≤–æ—Å—Ç–∏</a></li>
                    <li><a href="fishing_spots.html">–ú–µ—Å—Ç–∞ –¥–ª—è —Ä—ã–±–∞–ª–∫–∏</a></li>
                    <li><a href="tackle_baits.html">–°–Ω–∞—Å—Ç–∏ –∏ –ø—Ä–∏–º–∞–Ω–∫–∏</a></li>
                    <li><a href="beginners_tips.html">–°–æ–≤–µ—Ç—ã –Ω–∞—á–∏–Ω–∞—é—â–∏–º</a></li>
                    <li><a href="forum.html">–§–æ—Ä—É–º</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="forum-section">
            <div class="container">
                <h2>–§–æ—Ä—É–º —Ä—ã–±–æ–ª–æ–≤–æ–≤</h2>
                
                <div class="user-info" id="userInfo">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div class="forum-categories" id="forumCategories">
                    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div class="forum-actions" id="forumActions">
                    <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>

                <div class="topics">
                    <div class="topic">
                        <div class="topic-header">
                            <h4>–ü–æ–º–æ–≥–∏—Ç–µ —Å –≤—ã–±–æ—Ä–æ–º —Å–ø–∏–Ω–Ω–∏–Ω–≥–∞ –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–µ–≥–æ</h4>
                            <div class="topic-meta">
                                <span>–ê–≤—Ç–æ—Ä: –ê–ª–µ–∫—Å–µ–π_–†—ã–±–∞–∫</span>
                                <span>–î–∞—Ç–∞: 15.03.2024</span>
                                <span>–û—Ç–≤–µ—Ç–æ–≤: 12</span>
                            </div>
                        </div>
                        <img src="https://images.unsplash.com/photo-1596464716127-f2a82984de30" alt="–°–ø–∏–Ω–Ω–∏–Ω–≥" class="topic-image">
                        <p>–ü—Ä–∏–≤–µ—Ç –≤—Å–µ–º! –•–æ—á—É –Ω–∞—á–∞—Ç—å –ª–æ–≤–∏—Ç—å –Ω–∞ —Å–ø–∏–Ω–Ω–∏–Ω–≥, –Ω–æ –Ω–µ –∑–Ω–∞—é –∫–∞–∫–æ–π –≤—ã–±—Ä–∞—Ç—å. –ë—é–¥–∂–µ—Ç –¥–æ 5000 —Ä—É–±–ª–µ–π. –ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –Ω–∞ —á—Ç–æ –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ?</p>
                        <div class="topic-actions">
                            <button class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="rate-btn up" title="üëç">üëç</button>
                            <span class="rating">+8</span>
                        </div>
                    </div>

                    <div class="topic">
                        <div class="topic-header">
                            <h4>–û—Ç—á–µ—Ç –æ —Ä—ã–±–∞–ª–∫–µ –Ω–∞ –æ–∑–µ—Ä–µ –°–≤–µ—Ç–ª–æ–µ</h4>
                            <div class="topic-meta">
                                <span>–ê–≤—Ç–æ—Ä: –†—ã–±–æ–ª–æ–≤_–ü—Ä–æ</span>
                                <span>–î–∞—Ç–∞: 14.03.2024</span>
                                <span>–û—Ç–≤–µ—Ç–æ–≤: 15</span>
                            </div>
                        </div>
                        <img src="https://images.unsplash.com/photo-1593691509543-c55fb32e5cee" alt="–£–ª–æ–≤" class="topic-image">
                        <p>–í—á–µ—Ä–∞ –±—ã–ª –Ω–∞ –æ–∑–µ—Ä–µ –°–≤–µ—Ç–ª–æ–µ. –ü–æ–≥–æ–¥–∞ –æ—Ç–ª–∏—á–Ω–∞—è, –¥–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ. –ü–æ–π–º–∞–ª —â—É–∫—É –Ω–∞ 3.5 –∫–≥ –∏ –ø–∞—Ä—É –æ–∫—É–Ω–µ–π. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –≤–æ–±–ª–µ—Ä Rapala. –§–æ—Ç–æ –ø—Ä–∏–ª–∞–≥–∞—é.</p>
                        <div class="topic-actions">
                            <button class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="rate-btn up" title="üëç">üëç</button>
                            <span class="rating">+12</span>
                        </div>
                    </div>

                    <div class="topic">
                        <div class="topic-header">
                            <h4>–ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–ª—ë–≤–æ–º –Ω–∞ —Ä–µ–∫–µ –ë—ã—Å—Ç—Ä–∞—è</h4>
                            <div class="topic-meta">
                                <span>–ê–≤—Ç–æ—Ä: –ù–æ–≤–∏—á–æ–∫_2024</span>
                                <span>–î–∞—Ç–∞: 13.03.2024</span>
                                <span>–û—Ç–≤–µ—Ç–æ–≤: 8</span>
                            </div>
                        </div>
                        <img src="https://images.unsplash.com/photo-1596464716127-f2a82984de30" alt="–†–µ–∫–∞ –ë—ã—Å—Ç—Ä–∞—è" class="topic-image">
                        <p>–†–µ–±—è—Ç, –ø–æ–¥—Å–∫–∞–∂–∏—Ç–µ —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Ç–∞–∫? –¢—Ä–µ—Ç–∏–π –¥–µ–Ω—å —Ö–æ–∂—É –Ω–∞ —Ä–µ–∫—É –ë—ã—Å—Ç—Ä–∞—è, –Ω–æ —Ä—ã–±–∞ –Ω–µ –∫–ª—é—ë—Ç. –ò—Å–ø–æ–ª—å–∑—É—é —á–µ—Ä–≤—è –∏ –æ–ø–∞—Ä—ã—à–∞. –ú–æ–∂–µ—Ç –±—ã—Ç—å –¥–µ–ª–æ –≤ –ø–æ–≥–æ–¥–µ?</p>
                        <div class="topic-actions">
                            <button class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="rate-btn down" title="üëé">üëé</button>
                            <span class="rating">-2</span>
                        </div>
                    </div>

                    <div class="topic">
                        <div class="topic-header">
                            <h4>–û–±–∑–æ—Ä –Ω–æ–≤—ã—Ö –ø—Ä–∏–º–∞–Ω–æ–∫ 2024</h4>
                            <div class="topic-meta">
                                <span>–ê–≤—Ç–æ—Ä: –≠–∫—Å–ø–µ—Ä—Ç_–°–Ω–∞—Å—Ç–∏</span>
                                <span>–î–∞—Ç–∞: 12.03.2024</span>
                                <span>–û—Ç–≤–µ—Ç–æ–≤: 20</span>
                            </div>
                        </div>
                        <img src="https://images.unsplash.com/photo-1596464716127-f2a82984de30" alt="–ü—Ä–∏–º–∞–Ω–∫–∏" class="topic-image">
                        <p>–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –†–µ—à–∏–ª –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–∏–º–∞–Ω–æ–∫. –û—Å–æ–±–µ–Ω–Ω–æ –≤–ø–µ—á–∞—Ç–ª–∏–ª–∏ –≤–æ–±–ª–µ—Ä—ã –æ—Ç Lucky Craft –∏ –±–ª–µ—Å–Ω—ã –æ—Ç Mepps. –ü–æ–¥—Ä–æ–±–Ω—ã–π –æ–±–∑–æ—Ä –≤–Ω—É—Ç—Ä–∏.</p>
                        <div class="topic-actions">
                            <button class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="rate-btn up" title="üëç">üëç</button>
                            <span class="rating">+15</span>
                        </div>
                    </div>

                    <div class="topic">
                        <div class="topic-header">
                            <h4>–í–æ–ø—Ä–æ—Å –ø—Ä–æ –∑–∏–º–Ω—é—é —Ä—ã–±–∞–ª–∫—É</h4>
                            <div class="topic-meta">
                                <span>–ê–≤—Ç–æ—Ä: –ó–∏–º–Ω–∏–π_–†—ã–±–∞–∫</span>
                                <span>–î–∞—Ç–∞: 11.03.2024</span>
                                <span>–û—Ç–≤–µ—Ç–æ–≤: 10</span>
                            </div>
                        </div>
                        <img src="https://images.unsplash.com/photo-1596464716127-f2a82984de30" alt="–ó–∏–º–Ω—è—è —Ä—ã–±–∞–ª–∫–∞" class="topic-image">
                        <p>–ü–æ–¥—Å–∫–∞–∂–∏—Ç–µ, –∫–∞–∫—É—é —Ç–æ–ª—â–∏–Ω—É –ª–µ—Å–∫–∏ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –∑–∏–º–Ω–µ–π —Ä—ã–±–∞–ª–∫–∏ –Ω–∞ –æ–∫—É–Ω—è? –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É—é 0.15 –º–º, –Ω–æ –±–æ—é—Å—å —á—Ç–æ —Å–ª–∏—à–∫–æ–º —Ç–æ–Ω–∫–∞—è.</p>
                        <div class="topic-actions">
                            <button class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                            <button class="rate-btn up" title="üëç">üëç</button>
                            <span class="rating">+6</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>&copy; 2025 –†—ã–±–∞–ª–∫–∞. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkAuth() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userInfo = document.getElementById('userInfo');
            const forumActions = document.getElementById('forumActions');

            if (currentUser) {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                userInfo.innerHTML = `
                    <div class="user-welcome">
                        <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${currentUser.username}!</p>
                        <button onclick="logout()" class="logout-btn">–í—ã–π—Ç–∏</button>
                    </div>
                `;

                forumActions.innerHTML = `
                    <a href="new_topic.html" class="new-topic-btn">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é —Ç–µ–º—É</a>
                `;
            } else {
                // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
                userInfo.innerHTML = '';
                forumActions.innerHTML = `
                    <a href="login.html" class="login-btn">–í–æ–π—Ç–∏ –Ω–∞ —Ñ–æ—Ä—É–º</a>
                `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.reload();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 3600000) {
                const minutes = Math.floor(diff / 60000);
                return `${minutes} –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥`;
            }
            if (diff < 86400000) {
                const hours = Math.floor(diff / 3600000);
                return `${hours} —á–∞—Å–æ–≤ –Ω–∞–∑–∞–¥`;
            }
            return date.toLocaleDateString('ru-RU');
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–º
        function displayTopics() {
            const topics = JSON.parse(localStorage.getItem('forumTopics') || '[]');
            const categories = {
                general: { title: '–û–±—â–∏–µ –æ–±—Å—É–∂–¥–µ–Ω–∏—è', topics: [] },
                technique: { title: '–¢–µ—Ö–Ω–∏–∫–∞ –ª–æ–≤–ª–∏', topics: [] },
                tackle: { title: '–°–Ω–∞—Å—Ç–∏ –∏ –ø—Ä–∏–º–∞–Ω–∫–∏', topics: [] },
                spots: { title: '–ú–µ—Å—Ç–∞ –¥–ª—è —Ä—ã–±–∞–ª–∫–∏', topics: [] },
                reports: { title: '–û—Ç—á–µ—Ç—ã –æ —Ä—ã–±–∞–ª–∫–µ', topics: [] }
            };

            // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–º—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
            topics.forEach(topic => {
                if (categories[topic.category]) {
                    categories[topic.category].topics.push(topic);
                }
            });

            // –°–æ–∑–¥–∞–µ–º HTML –¥–ª—è –∫–∞–∂–¥–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            const forumCategories = document.getElementById('forumCategories');
            forumCategories.innerHTML = '';

            const currentUser = JSON.parse(localStorage.getItem('currentUser'));

            Object.entries(categories).forEach(([categoryId, category]) => {
                const categoryHtml = `
                    <div class="category">
                        <h3>${category.title}</h3>
                        <div class="topics">
                            ${category.topics.length > 0 ? category.topics.map(topic => `
                                <div class="topic">
                                    <div class="topic-header">
                                        <h4>${topic.title}</h4>
                                        ${currentUser && currentUser.id === topic.authorId ? 
                                            `<button onclick="deleteTopic(${topic.id})" class="delete-topic-btn" title="–£–¥–∞–ª–∏—Ç—å —Ç–µ–º—É">–£–¥–∞–ª–∏—Ç—å</button>` : 
                                            ''}
                                    </div>
                                    <div class="topic-content">
                                        ${topic.image ? `<img src="${topic.image}" alt="${topic.title}" class="topic-image">` : ''}
                                        <p>${topic.content}</p>
                                    </div>
                                    <div class="topic-meta">
                                        <span>–ê–≤—Ç–æ—Ä: ${topic.author}</span>
                                        <span>–°–æ–∑–¥–∞–Ω–æ: ${formatDate(topic.date)}</span>
                                        <span>–û—Ç–≤–µ—Ç–æ–≤: ${topic.replies.length}</span>
                                        <span>–¢–µ–≥–∏: ${topic.tags.join(', ')}</span>
                                        <span class="rating">–†–µ–π—Ç–∏–Ω–≥: ${topic.rating || 0}</span>
                                    </div>
                                    <div class="topic-actions">
                                        <button onclick="showReplyForm(${topic.id})" class="reply-btn">–û—Ç–≤–µ—Ç–∏—Ç—å</button>
                                        ${currentUser && currentUser.id !== topic.authorId ? 
                                            `<button onclick="rateTopic(${topic.id}, 1)" class="rate-btn up">üëç</button>
                                             <button onclick="rateTopic(${topic.id}, -1)" class="rate-btn down">üëé</button>` : 
                                            ''}
                                    </div>
                                    <div id="replyForm${topic.id}" class="reply-form" style="display: none;">
                                        <textarea placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –æ—Ç–≤–µ—Ç..." rows="3"></textarea>
                                        <button onclick="submitReply(${topic.id})" class="submit-reply-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç</button>
                                    </div>
                                    ${topic.replies.length > 0 ? `
                                        <div class="replies">
                                            ${topic.replies.map(reply => `
                                                <div class="reply">
                                                    <div class="reply-header">
                                                        <span class="reply-author">${reply.author}</span>
                                                        <span class="reply-date">${formatDate(reply.date)}</span>
                                                    </div>
                                                    <p>${reply.content}</p>
                                                </div>
                                            `).join('')}
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('') : '<p class="no-topics">–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–µ–º</p>'}
                        </div>
                    </div>
                `;
                forumCategories.innerHTML += categoryHtml;
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ–º—ã
        function deleteTopic(topicId) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            let topics = JSON.parse(localStorage.getItem('forumTopics') || '[]');
            const topic = topics.find(t => t.id === topicId);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–æ–º —Ç–µ–º—ã
            if (!currentUser || !topic || currentUser.id !== topic.authorId) {
                alert('–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —ç—Ç–æ–π —Ç–µ–º—ã!');
                return;
            }

            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–µ–º—É?')) {
                // –£–¥–∞–ª—è–µ–º —Ç–µ–º—É –∏–∑ —Å–ø–∏—Å–∫–∞
                topics = topics.filter(t => t.id !== topicId);
                localStorage.setItem('forumTopics', JSON.stringify(topics));
                
                // –£–¥–∞–ª—è–µ–º –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Ç–µ–º—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
                let userSubscriptions = JSON.parse(localStorage.getItem('userSubscriptions') || '{}');
                if (userSubscriptions[currentUser.id]) {
                    userSubscriptions[currentUser.id] = userSubscriptions[currentUser.id].filter(id => id !== topicId);
                    localStorage.setItem('userSubscriptions', JSON.stringify(userSubscriptions));
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–º
                displayTopics();
                alert('–¢–µ–º–∞ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞!');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã –æ—Ç–≤–µ—Ç–∞
        function showReplyForm(topicId) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser) {
                alert('–î–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                window.location.href = 'login.html';
                return;
            }
            const replyForm = document.getElementById(`replyForm${topicId}`);
            replyForm.style.display = 'block';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç–≤–µ—Ç–∞
        function submitReply(topicId) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const replyForm = document.getElementById(`replyForm${topicId}`);
            const replyContent = replyForm.querySelector('textarea').value;

            if (!replyContent.trim()) {
                alert('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞');
                return;
            }

            let topics = JSON.parse(localStorage.getItem('forumTopics') || '[]');
            const topicIndex = topics.findIndex(t => t.id === topicId);

            if (topicIndex !== -1) {
                const reply = {
                    id: Date.now(),
                    content: replyContent,
                    author: currentUser.username,
                    authorId: currentUser.id,
                    date: new Date().toISOString()
                };

                topics[topicIndex].replies.push(reply);
                localStorage.setItem('forumTopics', JSON.stringify(topics));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–º
                displayTopics();
                replyForm.style.display = 'none';
                replyForm.querySelector('textarea').value = '';
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Ç–µ–º—ã
        function rateTopic(topicId, value) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            let topics = JSON.parse(localStorage.getItem('forumTopics') || '[]');
            const topicIndex = topics.findIndex(t => t.id === topicId);

            if (topicIndex !== -1) {
                const topic = topics[topicIndex];
                if (!topic.rating) topic.rating = 0;
                if (!topic.ratings) topic.ratings = {};

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞–ª –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —ç—Ç—É —Ç–µ–º—É
                if (topic.ratings[currentUser.id]) {
                    if (topic.ratings[currentUser.id] === value) {
                        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –Ω–∞ —Ç—É –∂–µ –∫–Ω–æ–ø–∫—É, –æ—Ç–º–µ–Ω—è–µ–º –æ—Ü–µ–Ω–∫—É
                        topic.rating -= value;
                        delete topic.ratings[currentUser.id];
                    } else {
                        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç –æ—Ü–µ–Ω–∫—É
                        topic.rating = topic.rating - topic.ratings[currentUser.id] + value;
                        topic.ratings[currentUser.id] = value;
                    }
                } else {
                    // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ç–µ–º—É –≤–ø–µ—Ä–≤—ã–µ
                    topic.rating += value;
                    topic.ratings[currentUser.id] = value;
                }

                localStorage.setItem('forumTopics', JSON.stringify(topics));
                displayTopics();
            }
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        checkAuth();
        displayTopics();
    </script>
</body>
</html>